import{a as e,r as a,C as l,c as t,o as i,b as u,f as s,w as d,g as o,E as r,D as n,H as c,e as p,d as _,i as v,z as g,I as f,J as m}from"./index-Eg7O6Ff6.js";import{a as b}from"./index-fwOAAbVN.js";import{_ as h}from"./_plugin-vue_export-helper-BCo6x5W8.js";const w={class:"users-container"},y={class:"card-header-with-action"},z={key:0,class:"pagination-container"},x={key:1,class:"no-data"},C={class:"user-detail-container"},S={key:0,class:"user-detail-content"},k={class:"long-text"},I={class:"long-text"},P={class:"long-text"},D={key:1,class:"user-detail-empty"},U={class:"dialog-footer"},j=h({__name:"Users",setup(h){const j=e([]),V=e(!1),X=e(!1),A=a({currentPage:1,pageSize:20,total:0}),M=e(!1),N=e(null),T=e(null),B=async()=>{var e;V.value=!0;try{const a={skip:(A.currentPage-1)*A.pageSize,limit:A.pageSize},l=await b.users.getAll(a);Array.isArray(l.data)?(j.value=l.data,l.data.length<A.pageSize&&1===A.currentPage?A.total=l.data.length:l.data.length===A.pageSize?A.total=(null==(e=l.headers)?void 0:e["x-total-count"])?parseInt(l.headers["x-total-count"]):A.currentPage*A.pageSize+A.pageSize:A.total=(A.currentPage-1)*A.pageSize+l.data.length):(j.value=[],A.total=0)}catch(a){r.error("获取用户列表失败: "+(a.message||"未知错误")),j.value=[]}finally{V.value=!1}},F=e=>{if(!e)return"-";const a=new Date(e);return isNaN(a.getTime())?"-":a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},E=e=>{A.currentPage=e,B()},H=e=>{A.pageSize=e,A.currentPage=1,B()},J=e=>{N.value=e,T.value=null,M.value=!0,(async e=>{X.value=!0;try{const a=await b.users.getOne(e);T.value=a.data}catch(a){r.error("获取用户详情失败: "+(a.message||"未知错误")),T.value=null}finally{X.value=!1}})(e.id)};return l((()=>{B()})),(e,a)=>{const l=o("el-button"),h=o("el-table-column"),N=o("el-tag"),L=o("el-table"),O=o("el-pagination"),R=o("el-empty"),$=o("el-card"),q=o("el-descriptions-item"),G=o("el-descriptions"),K=o("el-tab-pane"),Q=o("el-tabs"),W=o("el-dialog"),Y=n("loading");return i(),t("div",w,[a[9]||(a[9]=u("div",{class:"page-header"},[u("h1",{class:"page-title"},"用户管理")],-1)),s($,{shadow:"never"},{header:d((()=>[u("div",y,[a[6]||(a[6]=u("span",null,"用户列表",-1)),s(l,{type:"primary",size:"small",onClick:B,loading:V.value},{default:d((()=>a[5]||(a[5]=[v("刷新")]))),_:1},8,["loading"])])])),default:d((()=>[c((i(),_(L,{data:j.value,style:{width:"100%"},border:"","empty-text":"无数据","highlight-current-row":"",onRowClick:J},{default:d((()=>[s(h,{prop:"id",label:"ID",width:"70"}),s(h,{prop:"person_name",label:"姓名","min-width":"150","show-overflow-tooltip":""},{default:d((e=>[v(g(e.row.person_name||"未设置"),1)])),_:1}),s(h,{prop:"school_name",label:"学校","min-width":"150","show-overflow-tooltip":""},{default:d((e=>[v(g(e.row.school_name||"-"),1)])),_:1}),s(h,{prop:"tel",label:"电话","min-width":"120","show-overflow-tooltip":""},{default:d((e=>[v(g(e.row.tel||"-"),1)])),_:1}),s(h,{prop:"is_active",label:"状态",width:"100"},{default:d((e=>[s(N,{type:e.row.is_active?"success":"info"},{default:d((()=>[v(g(e.row.is_active?"激活":"禁用"),1)])),_:2},1032,["type"])])),_:1}),s(h,{prop:"created_at",label:"创建时间","min-width":"180"},{default:d((e=>[v(g(F(e.row.created_at)),1)])),_:1}),s(h,{label:"操作",width:"100",fixed:"right"},{default:d((e=>[s(l,{size:"small",type:"danger",plain:"",onClick:f((a=>(async e=>{try{await m.confirm(`确定要删除用户 "${e.person_name||e.id}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.value=!0,await b.users.delete(e.id),r.success("删除成功"),await B()}catch(a){"cancel"!==a&&r.error("删除失败: "+(a.message||"未知错误"))}finally{V.value=!1}})(e.row)),["stop"]),disabled:V.value},{default:d((()=>a[7]||(a[7]=[v(" 删除 ")]))),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])),[[Y,V.value]]),A.total>0?(i(),t("div",z,[s(O,{"current-page":A.currentPage,"onUpdate:currentPage":a[0]||(a[0]=e=>A.currentPage=e),"page-size":A.pageSize,"onUpdate:pageSize":a[1]||(a[1]=e=>A.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:A.total,onSizeChange:H,onCurrentChange:E,disabled:V.value},null,8,["current-page","page-size","total","disabled"])])):V.value||0!==j.value.length?p("",!0):(i(),t("div",x,[s(R,{description:"暂无数据"})]))])),_:1}),s(W,{modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=e=>M.value=e),title:"用户详情",width:"70%","close-on-click-modal":!1,onClosed:a[4]||(a[4]=e=>T.value=null)},{footer:d((()=>[u("span",U,[s(l,{onClick:a[2]||(a[2]=e=>M.value=!1)},{default:d((()=>a[8]||(a[8]=[v("关闭")]))),_:1})])])),default:d((()=>[c((i(),t("div",C,[T.value?(i(),t("div",S,[s(Q,{type:"border-card"},{default:d((()=>[s(K,{label:"基本信息"},{default:d((()=>[s(G,{column:2,border:""},{default:d((()=>[s(q,{label:"ID"},{default:d((()=>[v(g(T.value.id),1)])),_:1}),s(q,{label:"姓名"},{default:d((()=>[v(g(T.value.person_name||"-"),1)])),_:1}),s(q,{label:"用户名"},{default:d((()=>[v(g(T.value.username||"-"),1)])),_:1}),s(q,{label:"电话"},{default:d((()=>[v(g(T.value.tel||"-"),1)])),_:1}),s(q,{label:"学校"},{default:d((()=>[v(g(T.value.school_name||"-"),1)])),_:1}),s(q,{label:"工作人员"},{default:d((()=>[v(g(T.value.worker_name||"-"),1)])),_:1}),s(q,{label:"状态"},{default:d((()=>[s(N,{type:T.value.is_active?"success":"info"},{default:d((()=>[v(g(T.value.is_active?"激活":"禁用"),1)])),_:1},8,["type"])])),_:1}),s(q,{label:"管理员"},{default:d((()=>[s(N,{type:T.value.is_admin?"warning":"info"},{default:d((()=>[v(g(T.value.is_admin?"是":"否"),1)])),_:1},8,["type"])])),_:1}),s(q,{label:"监控状态"},{default:d((()=>[s(N,{type:T.value.monitor_status?"success":"info"},{default:d((()=>[v(g(T.value.monitor_status?"开启":"关闭"),1)])),_:1},8,["type"])])),_:1}),s(q,{label:"创建时间"},{default:d((()=>[v(g(F(T.value.created_at)),1)])),_:1}),s(q,{label:"更新时间"},{default:d((()=>[v(g(F(T.value.updated_at)),1)])),_:1})])),_:1})])),_:1}),s(K,{label:"IM 信息"},{default:d((()=>[s(G,{column:2,border:""},{default:d((()=>[s(q,{label:"IM 用户名"},{default:d((()=>[v(g(T.value.im_username||"-"),1)])),_:1}),s(q,{label:"IM 密码"},{default:d((()=>[v(g(T.value.im_password||"-"),1)])),_:1})])),_:1})])),_:1}),s(K,{label:"系统信息"},{default:d((()=>[s(G,{column:1,border:""},{default:d((()=>[s(q,{label:"FID"},{default:d((()=>[v(g(T.value.fid||"-"),1)])),_:1}),s(q,{label:"CX_UID"},{default:d((()=>[v(g(T.value.cx_uid||"-"),1)])),_:1}),s(q,{label:"CX_D"},{default:d((()=>[u("div",k,g(T.value.cx_d||"-"),1)])),_:1}),s(q,{label:"CX_UF"},{default:d((()=>[u("div",I,g(T.value.cx_uf||"-"),1)])),_:1}),s(q,{label:"CX_VC3"},{default:d((()=>[u("div",P,g(T.value.cx_vc3||"-"),1)])),_:1}),s(q,{label:"密码哈希"},{default:d((()=>[v(g(T.value.hashed_password||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1})])):X.value?p("",!0):(i(),t("div",D,[s(R,{description:"无法获取用户详情"})]))])),[[Y,X.value]])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-f4d48915"]]);export{j as default};
