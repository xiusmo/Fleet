import{B as e,a}from"./index-Eg7O6Ff6.js";import{a as t}from"./index-fwOAAbVN.js";const s=e("auth",(()=>{const e=a(localStorage.getItem("token")||""),s=a(JSON.parse(localStorage.getItem("user")||"null")),o=a(!!e.value),l=()=>{e.value="",s.value=null,o.value=!1,localStorage.removeItem("token"),localStorage.removeItem("user")},r=async()=>{if(e.value)try{const e=await t.auth.getMe();s.value=e.data,localStorage.setItem("user",JSON.stringify(s.value))}catch(a){a.response&&401===a.response.status&&l()}};return{token:e,user:s,isLoggedIn:o,login:async a=>{var s,l;try{const s=await t.auth.login(a);return e.value=s.data.access_token,o.value=!0,localStorage.setItem("token",e.value),await r(),{success:!0}}catch(u){return{success:!1,message:(null==(l=null==(s=u.response)?void 0:s.data)?void 0:l.detail)||"登录失败，请检查用户名和密码"}}},logout:l,fetchUserInfo:r}}));export{s as u};
