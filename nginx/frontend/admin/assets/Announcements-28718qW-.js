import{a as e,r as a,C as l,c as t,o as n,b as u,f as i,w as r,g as o,E as s,D as d,i as c,H as p,e as m,d as g,z as v,I as _,K as h,L as f,J as b}from"./index-Eg7O6Ff6.js";import{a as w}from"./index-fwOAAbVN.js";import{_ as y}from"./_plugin-vue_export-helper-BCo6x5W8.js";const V={class:"announcements-container"},z={class:"page-header"},k={class:"card-header-with-action"},S={key:0,class:"pagination-container"},C={key:1,class:"no-data"},x={class:"dialog-footer"},P=y({__name:"Announcements",setup(y){const P=e([]),U=e(!1),D=e(!1),Y=e("发布公告"),j=e(!1),H=a({currentPage:1,pageSize:20,total:0}),I=a({uuid:"",title:"",content:"",status:"draft",is_pinned:!1,publish_date:null,cover_image:null}),M={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},N=e(null),A=e(!1),L=[{value:"draft",label:"草稿"},{value:"published",label:"已发布"},{value:"scheduled",label:"定时发布"},{value:"archived",label:"已归档"},{value:"advertisement",label:"广告"}],R=async()=>{var e;U.value=!0;try{const a={skip:(H.currentPage-1)*H.pageSize,limit:H.pageSize},l=await w.announcements.getAll(a);if(Array.isArray(l.data)){P.value=l.data;const a=null==(e=l.headers)?void 0:e["x-total-count"];a&&!isNaN(parseInt(a))?H.total=parseInt(a):l.data.length<H.pageSize?H.total=(H.currentPage-1)*H.pageSize+l.data.length:H.total=H.currentPage*H.pageSize+1}else P.value=[],H.total=0}catch(a){s.error("获取公告列表失败: "+(a.message||"未知错误")),P.value=[],H.total=0}finally{U.value=!1}},T=()=>{Y.value="发布公告",j.value=!1,q(),D.value=!0},O=async()=>{N.value&&await N.value.validate((async e=>{var a,l;if(e){A.value=!0;try{const e={title:I.title,content:I.content,status:I.status,is_pinned:I.is_pinned,publish_date:I.publish_date?new Date(I.publish_date).toISOString():null,cover_image:I.cover_image||null};j.value?(await w.announcements.update(I.uuid,e),s.success("更新成功")):(await w.announcements.create(e),s.success("发布成功")),D.value=!1,await R()}catch(t){const e=(null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.detail)||t.message||"未知错误";s.error(`保存失败: ${e}`)}finally{A.value=!1}}}))},q=()=>{I.uuid="",I.title="",I.content="",I.status="draft",I.is_pinned=!1,I.publish_date=null,I.cover_image=null,N.value&&N.value.clearValidate()},B=e=>{if(!e)return"-";const a=new Date(e);return isNaN(a.getTime())?"-":a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},E=e=>{switch(e){case"published":case"advertisement":return"success";case"scheduled":return"warning";case"archived":return"info";default:return"primary"}},$=e=>{(async e=>{try{Y.value="编辑公告",j.value=!0,q(),Object.keys(I).forEach((a=>{e.hasOwnProperty(a)&&("publish_date"===a&&e[a]?I[a]=new Date(e[a]):I[a]=e[a])})),D.value=!0}catch(a){s.error("加载公告详情失败: "+(a.message||"未知错误"))}})(e)},J=e=>{H.currentPage=e,R()},K=e=>{H.pageSize=e,H.currentPage=1,R()};return l((()=>{R()})),(e,a)=>{const l=o("el-button"),y=o("el-table-column"),j=o("el-tag"),Z=o("el-table"),F=o("el-pagination"),G=o("el-empty"),Q=o("el-card"),W=o("el-input"),X=o("el-form-item"),ee=o("el-option"),ae=o("el-select"),le=o("el-switch"),te=o("el-date-picker"),ne=o("el-form"),ue=o("el-dialog"),ie=d("loading");return n(),t("div",V,[u("div",z,[a[11]||(a[11]=u("h1",{class:"page-title"},"公告管理",-1)),i(l,{type:"primary",onClick:T},{default:r((()=>a[10]||(a[10]=[c("发布公告")]))),_:1})]),i(Q,{shadow:"never"},{header:r((()=>[u("div",k,[a[13]||(a[13]=u("span",null,"公告列表",-1)),i(l,{type:"primary",size:"small",onClick:R,loading:U.value},{default:r((()=>a[12]||(a[12]=[c("刷新")]))),_:1},8,["loading"])])])),default:r((()=>[p((n(),g(Z,{data:P.value,style:{width:"100%"},border:"","empty-text":"无数据","highlight-current-row":"",onRowClick:$},{default:r((()=>[i(y,{prop:"title",label:"标题","min-width":"150","show-overflow-tooltip":""}),i(y,{prop:"status",label:"状态",width:"120"},{default:r((e=>[i(j,{type:E(e.row.status)},{default:r((()=>{var a;return[c(v((null==(a=L.find((a=>a.value===e.row.status)))?void 0:a.label)||e.row.status),1)]})),_:2},1032,["type"])])),_:1}),i(y,{prop:"publish_date",label:"发布时间","min-width":"160"},{default:r((e=>[c(v(B(e.row.publish_date)),1)])),_:1}),i(y,{prop:"is_pinned",label:"置顶",width:"80"},{default:r((e=>[i(j,{type:e.row.is_pinned?"success":"info",size:"small"},{default:r((()=>[c(v(e.row.is_pinned?"是":"否"),1)])),_:2},1032,["type"])])),_:1}),i(y,{prop:"created_at",label:"创建时间","min-width":"160"},{default:r((e=>[c(v(B(e.row.created_at)),1)])),_:1}),i(y,{prop:"updated_at",label:"更新时间","min-width":"160"},{default:r((e=>[c(v(B(e.row.updated_at)),1)])),_:1}),i(y,{label:"操作",width:"100",fixed:"right"},{default:r((e=>[i(l,{size:"small",type:"danger",plain:"",onClick:_((a=>(async e=>{try{await b.confirm(`确定要删除标题为"${e.title}"的公告吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),U.value=!0,await w.announcements.delete(e.uuid),s.success("删除成功"),1===P.value.length&&H.currentPage>1&&H.currentPage--,await R()}catch(a){"cancel"!==a&&s.error("删除失败: "+(a.message||"未知错误"))}finally{U.value=!1}})(e.row)),["stop"]),disabled:U.value},{default:r((()=>a[14]||(a[14]=[c(" 删除 ")]))),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])),[[ie,U.value]]),H.total>0?(n(),t("div",S,[i(F,{"current-page":H.currentPage,"onUpdate:currentPage":a[0]||(a[0]=e=>H.currentPage=e),"page-size":H.pageSize,"onUpdate:pageSize":a[1]||(a[1]=e=>H.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:H.total,onSizeChange:K,onCurrentChange:J,disabled:U.value},null,8,["current-page","page-size","total","disabled"])])):U.value||0!==P.value.length?m("",!0):(n(),t("div",C,[i(G,{description:"暂无数据"})]))])),_:1}),i(ue,{modelValue:D.value,"onUpdate:modelValue":a[9]||(a[9]=e=>D.value=e),title:Y.value,width:"60%","close-on-click-modal":!1,"destroy-on-close":"",onClosed:q},{footer:r((()=>[u("span",x,[i(l,{onClick:a[8]||(a[8]=e=>D.value=!1)},{default:r((()=>a[15]||(a[15]=[c("取消")]))),_:1}),i(l,{type:"primary",onClick:O,loading:A.value},{default:r((()=>a[16]||(a[16]=[c("确定")]))),_:1},8,["loading"])])])),default:r((()=>[p((n(),g(ne,{ref_key:"formRef",ref:N,model:I,rules:M,"label-width":"100px"},{default:r((()=>[i(X,{label:"标题",prop:"title"},{default:r((()=>[i(W,{modelValue:I.title,"onUpdate:modelValue":a[2]||(a[2]=e=>I.title=e),placeholder:"请输入公告标题"},null,8,["modelValue"])])),_:1}),i(X,{label:"内容",prop:"content"},{default:r((()=>[i(W,{type:"textarea",rows:5,modelValue:I.content,"onUpdate:modelValue":a[3]||(a[3]=e=>I.content=e),placeholder:"请输入公告内容 (支持 Markdown)"},null,8,["modelValue"])])),_:1}),i(X,{label:"状态",prop:"status"},{default:r((()=>[i(ae,{modelValue:I.status,"onUpdate:modelValue":a[4]||(a[4]=e=>I.status=e),placeholder:"选择状态"},{default:r((()=>[(n(),t(h,null,f(L,(e=>i(ee,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),i(X,{label:"是否置顶",prop:"is_pinned"},{default:r((()=>[i(le,{modelValue:I.is_pinned,"onUpdate:modelValue":a[5]||(a[5]=e=>I.is_pinned=e)},null,8,["modelValue"])])),_:1}),i(X,{label:"发布时间",prop:"publish_date"},{default:r((()=>[i(te,{modelValue:I.publish_date,"onUpdate:modelValue":a[6]||(a[6]=e=>I.publish_date=e),type:"datetime",placeholder:"选择发布时间 (留空则立即发布)",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ssZ",clearable:""},null,8,["modelValue"])])),_:1}),i(X,{label:"封面图片URL",prop:"cover_image"},{default:r((()=>[i(W,{modelValue:I.cover_image,"onUpdate:modelValue":a[7]||(a[7]=e=>I.cover_image=e),placeholder:"输入图片URL (可选)",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])),[[ie,A.value]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-c63b6ce8"]]);export{P as default};
