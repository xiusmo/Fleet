import{a}from"./index-fwOAAbVN.js";import{a as e,j as l,C as t,c as s,o as r,b as d,f as o,w as u,g as i,D as n,d as c,z as v,k as p,p as h,m as f,F as m,G as w,H as y,i as _}from"./index-Eg7O6Ff6.js";import{_ as g}from"./_plugin-vue_export-helper-BCo6x5W8.js";const b={class:"dashboard-container"},k={class:"card-header"},x={key:0,class:"card-value"},D={class:"card-header"},z={key:0,class:"card-value"},C={class:"card-header"},j={key:0,class:"card-value"},F={class:"card-header"},S={key:0,class:"card-value"},I={class:"card-header-with-action"},A={class:"card-header-with-action"},V=g({__name:"Dashboard",setup(g){const V=e({}),E=e([]),G=e([]),H=e(!0),L=e(!0),N=e(!0),P=l((()=>{var a;return(null==(a=V.value)?void 0:a.disk)&&V.value.disk["/System/Volumes/Data"]?V.value.disk["/System/Volumes/Data"]:{total:0,used:0,free:0,percent:0}})),U=async()=>{L.value=!0;try{const e=await a.workers.getAll();E.value=e.data}catch(e){}finally{L.value=!1}},q=async()=>{N.value=!0;try{const e=await a.logs.getAll({limit:10});G.value=e.data}catch(e){}finally{N.value=!1}},B=l((()=>{const a={total:E.value.length,online:0,offline:0,busy:0,error:0};return E.value.forEach((e=>{e.status in a&&a[e.status]++})),a})),J=a=>{if(!a)return"-";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};return t((()=>{(async()=>{H.value=!0;try{const e=await a.system.getStatus();V.value=e.data}catch(e){}finally{H.value=!1}})(),U(),q()})),(a,e)=>{const l=i("el-icon"),t=i("el-skeleton"),g=i("el-card"),K=i("el-col"),M=i("el-row"),O=i("el-button"),Q=i("el-table-column"),R=i("el-tag"),T=i("el-table"),W=n("loading");return r(),s("div",b,[e[8]||(e[8]=d("h1",{class:"page-title"},"控制面板",-1)),o(M,{gutter:20},{default:u((()=>[o(K,{xs:24,sm:12,md:6},{default:u((()=>[o(g,{shadow:"hover",class:"status-card"},{header:u((()=>[d("div",k,[e[0]||(e[0]=d("span",null,"CPU 使用率",-1)),o(l,null,{default:u((()=>[o(p(h))])),_:1})])])),default:u((()=>[H.value?(r(),c(t,{key:1,rows:1,animated:""})):(r(),s("div",x,v(void 0!==V.value.cpu_percent?V.value.cpu_percent.toFixed(1)+"%":"加载中..."),1))])),_:1})])),_:1}),o(K,{xs:24,sm:12,md:6},{default:u((()=>[o(g,{shadow:"hover",class:"status-card"},{header:u((()=>[d("div",D,[e[1]||(e[1]=d("span",null,"内存使用率",-1)),o(l,null,{default:u((()=>[o(p(f))])),_:1})])])),default:u((()=>{var a;return[H.value?(r(),c(t,{key:1,rows:1,animated:""})):(r(),s("div",z,v(void 0!==(null==(a=V.value.memory)?void 0:a.percent)?V.value.memory.percent.toFixed(1)+"%":"加载中..."),1))]})),_:1})])),_:1}),o(K,{xs:24,sm:12,md:6},{default:u((()=>[o(g,{shadow:"hover",class:"status-card"},{header:u((()=>[d("div",C,[e[2]||(e[2]=d("span",null,"磁盘使用率",-1)),o(l,null,{default:u((()=>[o(p(m))])),_:1})])])),default:u((()=>[H.value?(r(),c(t,{key:1,rows:1,animated:""})):(r(),s("div",j,v(void 0!==P.value.percent?P.value.percent.toFixed(1)+"%":"加载中..."),1))])),_:1})])),_:1}),o(K,{xs:24,sm:12,md:6},{default:u((()=>[o(g,{shadow:"hover",class:"status-card"},{header:u((()=>[d("div",F,[e[3]||(e[3]=d("span",null,"工作节点",-1)),o(l,null,{default:u((()=>[o(p(w))])),_:1})])])),default:u((()=>[L.value?(r(),c(t,{key:1,rows:1,animated:""})):(r(),s("div",S,v(B.value.online)+"/"+v(B.value.total)+" 在线 ",1))])),_:1})])),_:1})])),_:1}),o(g,{class:"box-card",style:{"margin-top":"20px"}},{header:u((()=>[d("div",I,[e[5]||(e[5]=d("span",null,"工作节点状态",-1)),o(O,{type:"primary",size:"small",onClick:U},{default:u((()=>e[4]||(e[4]=[_("刷新")]))),_:1})])])),default:u((()=>[y((r(),c(T,{data:E.value,style:{width:"100%"},border:""},{default:u((()=>[o(Q,{prop:"id",label:"ID",width:"70"}),o(Q,{prop:"name",label:"名称","min-width":"120"}),o(Q,{prop:"endpoint",label:"节点地址","min-width":"180"}),o(Q,{prop:"status",label:"状态",width:"100"},{default:u((a=>[o(R,{type:"online"===a.row.status?"success":"offline"===a.row.status?"info":"busy"===a.row.status?"warning":"danger"},{default:u((()=>[_(v("online"===a.row.status?"在线":"offline"===a.row.status?"离线":"busy"===a.row.status?"忙碌中":"错误"),1)])),_:2},1032,["type"])])),_:1}),o(Q,{prop:"last_heartbeat",label:"最后心跳","min-width":"160"},{default:u((a=>[_(v(J(a.row.last_heartbeat)),1)])),_:1})])),_:1},8,["data"])),[[W,L.value]])])),_:1}),o(g,{class:"box-card",style:{"margin-top":"20px"}},{header:u((()=>[d("div",A,[e[7]||(e[7]=d("span",null,"最新系统日志",-1)),o(O,{type:"primary",size:"small",onClick:q},{default:u((()=>e[6]||(e[6]=[_("刷新")]))),_:1})])])),default:u((()=>[y((r(),c(T,{data:G.value,style:{width:"100%"},border:""},{default:u((()=>[o(Q,{prop:"id",label:"ID",width:"70"}),o(Q,{prop:"level",label:"级别",width:"100"},{default:u((a=>{return[o(R,{type:(e=a.row.level,{debug:"info",info:"info",warning:"warning",error:"danger",critical:"danger"}[e]||"info"),size:"small"},{default:u((()=>[_(v(a.row.level),1)])),_:2},1032,["type"])];var e})),_:1}),o(Q,{prop:"category",label:"类别",width:"100"}),o(Q,{prop:"message",label:"消息","min-width":"250","show-overflow-tooltip":""}),o(Q,{prop:"created_at",label:"时间","min-width":"160"},{default:u((a=>[_(v(J(a.row.created_at)),1)])),_:1})])),_:1},8,["data"])),[[W,N.value]])])),_:1})])}}},[["__scopeId","data-v-c9e6cba0"]]);export{V as default};
